ğŸ“ src
  ğŸ“„ app.config.ts
  ğŸ“„ app.scss
  ğŸ“„ app.ts
  ğŸ“ components
    ğŸ“ BannerCarousel
      ğŸ“„ index.scss
      ğŸ“„ index.tsx
    ğŸ“ ShowcaseSection
      ğŸ“„ index.scss
      ğŸ“„ index.tsx
  ğŸ“„ index.html
  ğŸ“ packageA
    ğŸ“ pages
  ğŸ“ pages
    ğŸ“ index
      ğŸ“„ index.config.ts
      ğŸ“„ index.scss
      ğŸ“„ index.tsx
  ğŸ“ services
    ğŸ“ api
      ğŸ“ index
        ğŸ“„ data.ts
        ğŸ“„ indexApi.ts
        ğŸ“„ types.ts
    ğŸ“ http
      ğŸ“„ cache.ts
      ğŸ“„ config.ts
      ğŸ“„ errorHandler.ts
      ğŸ“„ index.ts
      ğŸ“„ interceptor.ts
      ğŸ“„ request.ts
      ğŸ“„ types.ts
  ğŸ“ styles
    ğŸ“„ theme.css

===== File: app.config.ts =====
export default defineAppConfig({
  // å°†æ‰€æœ‰TabBaré¡µé¢æ”¾åœ¨ä¸»åŒ…ä¸­
  pages: [
    'pages/index/index',
    'pages/product/index',
    'pages/cases/index',
    'pages/contact/index'
  ],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#FFFFFF',
    navigationBarTitleText: 'éƒ‘å¼ä¿®ç¼®', // ä¿®æ”¹å¯¼èˆªæ ‡é¢˜
    navigationBarTextStyle: 'black'
  },
  // éTabBaré¡µé¢å¯ä»¥æ”¾åœ¨åˆ†åŒ…ä¸­
  subPackages: [],
  tabBar: {
    color: '#757575',
    selectedColor: '#2563EB',
    backgroundColor: '#FFFFFF',
    borderStyle: 'white',
    list: [
      {
        pagePath: 'pages/index/index',
        text: 'é¦–é¡µ',
        iconPath: 'assets/tab-bar/home.png',
        selectedIconPath: 'assets/tab-bar/home-active.png'
      },
      {
        pagePath: 'pages/product/index',
        text: 'äº§å“',
        iconPath: 'assets/tab-bar/service.png',
        selectedIconPath: 'assets/tab-bar/service-active.png'
      },
      {
        pagePath: 'pages/cases/index',
        text: 'æ¡ˆä¾‹',
        iconPath: 'assets/tab-bar/case.png',
        selectedIconPath: 'assets/tab-bar/case-active.png'
      },
      {
        pagePath: 'pages/contact/index',
        text: 'è”ç³»æˆ‘ä»¬',
        iconPath: 'assets/tab-bar/contact.png',
        selectedIconPath: 'assets/tab-bar/contact-active.png'
      }
    ]
  },
  lazyCodeLoading: "requiredComponents"
})
===== End of File: app.config.ts =====


===== File: app.scss =====
/* app.scss - é€‚ç”¨äº Taro + NutUI React å¤šç«¯é¡¹ç›® */

/* å…¨å±€åŸºç¡€æ ·å¼ */
page {
    height: 100%;
    font-size: 16px;
    line-height: 1.5;
    color: var(--nutui-gray-7);
    background-color: var(--nutui-gray-3);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  }
  
  /* å®¹å™¨å¸ƒå±€ */
  .container {
    padding: 10px;
  }
  
  /* å¼¹æ€§å¸ƒå±€å·¥å…· */
  .flex {
    display: flex;
    
    &-center {
      align-items: center;
      justify-content: center;
    }
    
    &-between {
      align-items: center;
      justify-content: space-between;
    }
    
    &-column {
      flex-direction: column;
    }
  }
  
  /* é—´è·è¾…åŠ©ç±» - ç²¾ç®€ç‰ˆ */
  .mt-10 { margin-top: 10px; }
  .mr-10 { margin-right: 10px; }
  .mb-10 { margin-bottom: 10px; }
  .ml-10 { margin-left: 10px; }
  .pt-10 { padding-top: 10px; }
  .pr-10 { padding-right: 10px; }
  .pb-10 { padding-bottom: 10px; }
  .pl-10 { padding-left: 10px; }
  
  /* å¸¸ç”¨æ–‡æœ¬æ ·å¼ */
  .text-primary { color: var(--nutui-color-primary); }
  .text-center { text-align: center; }
  .text-bold { font-weight: bold; }
  
  /* å¡ç‰‡ç»„ä»¶ */
  .card {
    background-color: #fff;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  /* 1px è¾¹æ¡†è§£å†³æ–¹æ¡ˆ */
  .hairline-bottom {
    position: relative;
    
    &::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 1px;
      background-color: var(--nutui-gray-4);
      transform: scaleY(0.5);
    }
  }
  
  /* å®‰å…¨åŒºé€‚é… */
  .safe-bottom {
    padding-bottom: constant(safe-area-inset-bottom);
    padding-bottom: env(safe-area-inset-bottom);
  }
===== End of File: app.scss =====


===== File: app.ts =====
import  { useEffect } from 'react'
import { useDidShow, useDidHide } from '@tarojs/taro'

// å…¨å±€æ ·å¼
import './styles/theme.css'
import './app.scss'

function App(props) {
  // å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„ React Hooks
  useEffect(() => {})

  // å¯¹åº” onShow
  useDidShow(() => {})

  // å¯¹åº” onHide
  useDidHide(() => {})

  return props.children
}

export default App
===== End of File: app.ts =====


===== File: components\BannerCarousel\index.scss =====
.banner-carousel {
  width: 100%;
  height: 180px;
  overflow: hidden;
  position: relative;
}

.banner-swiper {
  width: 100%;
  height: 100%;
}

.banner-item {
  width: 100%;
  height: 100%;
  position: relative;
}

.banner-image {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
}

.banner-content {
  position: absolute;
  z-index: 2;
  left: 0;
  bottom: 0;
  width: 100%;
  padding: 16px 20px;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0));
  text-align: left;
}

.banner-title {
  font-size: 22px;
  font-weight: bold;
  color: #fff;
  margin-bottom: 4px;
  display: block;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
}

.banner-subtitle {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  display: block;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
}
===== End of File: components\BannerCarousel\index.scss =====


===== File: components\BannerCarousel\index.tsx =====
import { View, Text, Image, Swiper, SwiperItem } from '@tarojs/components'
import { Banner } from 'src/services/api/index/types'
import './index.scss'

interface BannerCarouselProps {
  banners: Banner[];
}

export default function BannerCarousel({ banners }: BannerCarouselProps) {
  return (
    <View className='banner-carousel'>
      <Swiper
        className='banner-swiper'
        indicatorColor='#ddd'
        indicatorActiveColor='#2563EB'
        circular
        indicatorDots
        autoplay
        interval={3500}
      >
        {banners.map(banner => (
          <SwiperItem key={banner.id}>
            <View className='banner-item'>
              <Image 
                className='banner-image' 
                src={banner.imageUrl} 
                mode='aspectFill'
              />
              <View className='banner-content'>
                {banner.title && (
                  <Text className='banner-title'>{banner.title}</Text>
                )}
                
                {banner.subtitle && (
                  <Text className='banner-subtitle'>{banner.subtitle}</Text>
                )}
              </View>
            </View>
          </SwiperItem>
        ))}
      </Swiper>
    </View>
  )
}
===== End of File: components\BannerCarousel\index.tsx =====


===== File: components\ShowcaseSection\index.scss =====
// src/components/ShowcaseSection/index.scss

// é€šç”¨æ¿å—æ ·å¼
.section {
    margin: 0 15px 20px;
    background: #fff;
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
  }
  
  .section-header {
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .section-title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    position: relative;
    padding-left: 12px;
    
    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 18px;
      background: linear-gradient(to bottom, #3B82F6, #2563EB);
      border-radius: 4px;
    }
  }
  
  // å›¾ç‰‡åŠ è½½å’Œé”™è¯¯çŠ¶æ€
  .case-image-loading,
  .case-image-error {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f0f0f0;
    color: #999;
    font-size: 14px;
  }
  
  .case-image-error {
    background-color: #fafafa;
  }
  
  // æ¡ˆä¾‹å±•ç¤º
  .case-container {
    margin-top: 5px;
  }
  
  .case-feature {
    margin-bottom: 15px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    
    &:active {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
    }
    
    .case-image {
      width: 100%;
      height: 160px;
      border-radius: 0;
      
      :global(.nut-image-img) {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
    
    .case-content {
      padding: 12px;
      background: #fff;
    }
    
    .case-title {
      font-size: 15px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
      display: block;
    }
    
    .case-description {
      font-size: 13px;
      color: #666;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.5;
    }
  }
  
  .case-grid {
    display: flex;
    justify-content: space-between;
    
    .case-item {
      width: calc(50% - 5px);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      
      &:active {
        transform: translateY(-2px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
      }
      
      .case-image {
        width: 100%;
        height: 90px;
        border-radius: 0;
        
        :global(.nut-image-img) {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
      }
      
      .case-content {
        padding: 10px;
        background: #fff;
      }
      
      .case-title {
        font-size: 13px;
        color: #333;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
        font-weight: 500;
      }
    }
  }
  
  // å¼¹çª—æ ·å¼
  .case-detail-popup {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .popup-header {
    padding: 16px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .popup-title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    flex: 1;
    padding-right: 10px;
  }
  
  .popup-close {
    width: 28px;
    height: 28px;
    font-size: 24px;
    line-height: 24px;
    text-align: center;
    color: #999;
    border-radius: 50%;
    background-color: #f5f5f5;
    
    &:active {
      background-color: #eee;
      color: #666;
    }
  }
  
  .popup-content {
    flex: 1;
    padding: 10px 16px 16px 16px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .case-detail-image {
    width: 100%;
    height: 160px;
    object-fit: cover;
    border-radius: 12px;
    margin-top: 0;
    margin-bottom: 10px;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    
    :global(.nut-image-img) {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }
  }
  
  .case-detail-description {
    font-size: 14px;
    font-weight: bold;
    color: #2563EB;
    margin-bottom: 12px;
    display: block;
  }
  
  .case-detail-content {
    font-size: 14px;
    color: #666;
    line-height: 1.6;
    margin-bottom: 20px;
    display: block;
    text-align: justify;
  }
  
  .detail-button {
    margin-top: 20px;
    height: 44px;
    font-size: 15px;
    font-weight: 500;
    border-radius: 8px;
    box-shadow: 0 3px 8px rgba(37, 99, 235, 0.2);
    background: #2563EB;
    color: #fff;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    
    &:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(37, 99, 235, 0.2);
      background: #1d4ed8;
    }
  }
===== End of File: components\ShowcaseSection\index.scss =====


===== File: components\ShowcaseSection\index.tsx =====
// src/components/ShowcaseSection/index.tsx
import { useState } from 'react'
import { View, Text } from '@tarojs/components'
import { Image, Popup } from '@nutui/nutui-react-taro'
import Taro from '@tarojs/taro'
import { Showcase } from 'src/services/api/index/indexApi'
import './index.scss'

interface ShowcaseSectionProps {
  showcases: Showcase[];
  title?: string;
  contactPhone?: string;
  onShowToast?: (message: string, type: 'success' | 'fail' | 'warn') => void;
}

const ShowcaseSection: React.FC<ShowcaseSectionProps> = ({
  showcases,
  title = 'ç²¾é€‰æ¡ˆä¾‹',
  contactPhone,
  onShowToast
}) => {
  // çŠ¶æ€ç®¡ç†
  const [showShowcaseDetail, setShowShowcaseDetail] = useState(false);
  const [selectedShowcase, setSelectedShowcase] = useState<Showcase | null>(null);

  // æŸ¥çœ‹æ¡ˆä¾‹è¯¦æƒ…
  const handleShowcaseClick = (showcase: Showcase) => {
    setSelectedShowcase(showcase);
    setShowShowcaseDetail(true);
  };

  // ç”µè¯å’¨è¯¢
  const handleCall = () => {
    if (!contactPhone) return;
    
    Taro.makePhoneCall({
      phoneNumber: contactPhone
    }).catch(err => {
      if (err.errMsg && !err.errMsg.includes('cancel')) {
        onShowToast?.('æ‹¨å·å¤±è´¥', 'fail');
      }
    });
  };

  if (!showcases?.length) {
    return null;
  }

  return (
    <View className='section showcase-section'>
      <View className='section-header'>
        <Text className='section-title'>{title}</Text>
      </View>
      
      <View className='case-container'>
        {/* ä¸»æ¡ˆä¾‹ */}
        <View 
          className='case-feature'
          onClick={() => handleShowcaseClick(showcases[0])}
        >
          <Image 
            src={showcases[0].imageUrl}
            width="100%"
            height="160px"
            className='case-image'
            loading={<View className="case-image-loading"></View>}
            error={<View className="case-image-error"></View>}
          />
          <View className='case-content'>
            <Text className='case-title'>{showcases[0].title}</Text>
            <Text className='case-description'>{showcases[0].description}</Text>
          </View>
        </View>
        
        {/* æ¬¡è¦æ¡ˆä¾‹ç½‘æ ¼ */}
        {showcases.length > 1 && (
          <View className='case-grid'>
            {showcases.slice(1).map(item => (
              <View 
                key={item.id} 
                className='case-item'
                onClick={() => handleShowcaseClick(item)}
              >
                <Image 
                  src={item.imageUrl}
                  width="100%"
                  height="90px"
                  className='case-image'
                  loading={<View className="case-image-loading"></View>}
                  error={<View className="case-image-error"></View>}
                />
                <View className='case-content'>
                  <Text className='case-title'>{item.title}</Text>
                </View>
              </View>
            ))}
          </View>
        )}
      </View>

      {/* æ¡ˆä¾‹è¯¦æƒ…å¼¹çª— */}
      {selectedShowcase && (
        <Popup
          visible={showShowcaseDetail}
          position="bottom"
          round
          onClose={() => setShowShowcaseDetail(false)}
          style={{ height: '70%' }}
        >
          <View className='case-detail-popup'>
            <View className='popup-header'>
              <Text className='popup-title'>{selectedShowcase.title}</Text>
              <View 
                className='popup-close'
                onClick={() => setShowShowcaseDetail(false)}
              >
                Ã—
              </View>
            </View>
            <View className='popup-content'>
              <Image 
                src={selectedShowcase.imageUrl}
                width="100%"
                height="160px"
                className='case-detail-image'
                loading={<View className="case-image-loading"></View>}
                error={<View className="case-image-error"></View>}
              />
              <Text className='case-detail-description'>{selectedShowcase.description}</Text>
              <Text className='case-detail-content'>{selectedShowcase.content}</Text>
              {contactPhone && (
                <View 
                  className='detail-button'
                  onClick={handleCall}
                >
                  å’¨è¯¢æ­¤æ–¹æ¡ˆ
                </View>
              )}
            </View>
          </View>
        </Popup>
      )}
    </View>
  );
};

export default ShowcaseSection;
===== End of File: components\ShowcaseSection\index.tsx =====


===== File: index.html =====
<!DOCTYPE html>
<html>
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="format-detection" content="telephone=no,address=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
  <title>waterproof</title>
  <script><%= htmlWebpackPlugin.options.script %></script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
===== End of File: index.html =====


===== File: pages\index\index.config.ts =====
export default {
  navigationBarTitleText: 'éƒ‘å¼ä¿®ç¼®',
  enablePullDownRefresh: true,
  backgroundColor: '#f5f5f5',
  backgroundTextStyle: 'dark',
  navigationBarBackgroundColor: '#ffffff',
  navigationBarTextStyle: 'black'
}
===== End of File: pages\index\index.config.ts =====


===== File: pages\index\index.scss =====
/* é˜²æ°´æœåŠ¡å°ç¨‹åºæ ·å¼ */

// é¡µé¢æ•´ä½“æ ·å¼
.page {
  background-color: #f5f7fa;
  min-height: 100vh;
  padding-bottom: calc(20px + env(safe-area-inset-bottom));
}

// åŠ è½½çŠ¶æ€
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  
  .loading-text {
    margin-top: 12px;
    color: #666;
    font-size: 14px;
  }
}
===== End of File: pages\index\index.scss =====


===== File: pages\index\index.tsx =====
// pages/index/index.tsx
import { useEffect, useState } from 'react'
import { View, Text } from '@tarojs/components'
import { Toast, Loading } from '@nutui/nutui-react-taro'
import Taro from '@tarojs/taro'
import './index.scss'

// å¯¼å…¥ç»„ä»¶
import BannerCarousel from 'src/components/BannerCarousel'
import QuickContact from 'src/components/QuickContact'
import ServiceSection from 'src/components/ServiceSection'
import ShowcaseSection from 'src/components/ShowcaseSection'

// ç›´æ¥å¯¼å…¥APIå’Œç±»å‹
import { IndexData } from 'src/services/api/index/types'
import { getIndexData, handleIndexError } from 'src/services/api/index/indexApi'

export default function IndexPage() {
  // çŠ¶æ€ç®¡ç†
  const [loading, setLoading] = useState(true)
  const [indexData, setIndexData] = useState<IndexData | null>(null)
  const [showToast, setShowToast] = useState(false)
  const [toastMsg, setToastMsg] = useState('')
  const [toastType, setToastType] = useState<'success' | 'fail' | 'warn'>('success')
  
  // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
  const showToastMessage = (message: string, type: 'success' | 'fail' | 'warn' = 'success') => {
    if (showToast) {
      setShowToast(false)
      setTimeout(() => {
        setToastMsg(message)
        setToastType(type)
        setShowToast(true)
      }, 100)
    } else {
      setToastMsg(message)
      setToastType(type)
      setShowToast(true)
    }
  }
  
  // è·å–æ•°æ®
  useEffect(() => {
    const fetchData = async () => {
      setLoading(true)
      
      try {
        // è·å–æ‰€æœ‰é¦–é¡µæ•°æ®
        const result = await getIndexData()
        
        if (result.success && result.data) {
          setIndexData(result.data)
        } else {
          showToastMessage(result.error || 'è·å–é¦–é¡µæ•°æ®å¤±è´¥', 'fail')
        }
      } catch (error) {
        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
        showToastMessage(handleIndexError(error), 'fail')
      } finally {
        setLoading(false)
      }
    }
    
    fetchData()
  }, [])
  
  // ä¸‹æ‹‰åˆ·æ–°å¤„ç†
  useEffect(() => {
    Taro.eventCenter.on('pullDownRefresh', async () => {
      try {
        // åˆ·æ–°é¦–é¡µæ•°æ®
        const result = await getIndexData()
        
        if (result.success && result.data) {
          setIndexData(result.data)
          showToastMessage('åˆ·æ–°æˆåŠŸ', 'success')
        } else {
          showToastMessage(result.error || 'åˆ·æ–°æ•°æ®å¤±è´¥', 'fail')
        }
      } catch (error) {
        showToastMessage(handleIndexError(error), 'fail')
      } finally {
        Taro.stopPullDownRefresh()
      }
    })
    
    return () => {
      Taro.eventCenter.off('pullDownRefresh')
    }
  }, [])
  
  // åŠ è½½çŠ¶æ€
  if (loading || !indexData) {
    return (
      <View className='loading-container'>
        <Loading type='spinner' />
        <Text className='loading-text'>åŠ è½½ä¸­...</Text>
      </View>
    )
  }
  
  return (
    <View className='page'>
      {/* BanneråŒºåŸŸ */}
      <BannerCarousel banners={indexData.banners} />
      
      {/* å¿«é€Ÿè”ç³» */}
      <QuickContact 
        contactInfo={indexData.contactInfo}
        onShowToast={showToastMessage}
      />
      
      {/* æœåŠ¡åˆ†ç±» */}
      <ServiceSection services={indexData.services} />
      
      {/* ç²¾é€‰æ¡ˆä¾‹ */}
      <ShowcaseSection 
        showcases={indexData.showcases}
        contactPhone={indexData.contactInfo.phone}
        onShowToast={showToastMessage}
      />
      
      {/* Toastç»„ä»¶ */}
      <Toast
        msg={toastMsg}
        visible={showToast}
        type={toastType}
        onClose={() => setShowToast(false)}
        duration={2000}
        position='center'
        closeOnOverlayClick
      />
    </View>
  )
}
===== End of File: pages\index\index.tsx =====


===== File: services\api\index\data.ts =====
// services/api/index/data.ts
import { IndexData } from './types';

// é¦–é¡µæ¨¡æ‹Ÿæ•°æ®
export const indexData: IndexData = {
  // æœåŠ¡æ•°æ® - ä¿®æ”¹ä¸ºæ–°çš„å››é¡¹æœåŠ¡
  services: [
    {
      id: 1,
      title: 'æ¼æ°´æ£€æµ‹',
      description: 'ä¸“ä¸šæ£€æµ‹æŠ€æœ¯ï¼Œç²¾å‡†å®šä½æ¼æ°´ç‚¹'
    },
    {
      id: 2,
      title: 'é˜²æ°´æ–½å·¥',
      description: 'é«˜æ ‡å‡†é˜²æ°´å·¥ç¨‹ï¼Œæœç»åé¡¾ä¹‹å¿§'
    },
    {
      id: 3,
      title: 'æ¸—æ¼ç»´ä¿®',
      description: 'å¿«é€Ÿåº”å¯¹å„ç±»æ¸—æ¼é—®é¢˜ï¼ŒåŠæ—¶ä¿®å¤'
    },
    {
      id: 4,
      title: 'ææ–™é”€å”®',
      description: 'ä¼˜è´¨é˜²æ°´ææ–™ï¼Œä¸“ä¸šæŠ€æœ¯æ”¯æŒ'
    }
  ],
  
  // ç²¾é€‰æ¡ˆä¾‹æ•°æ®
  showcases: [
    {
      id: '1',
      imageUrl: 'https://storage.360buyimg.com/jdc-article/welcomenutui.jpg',
      title: 'åŸå¸‚èŠ±å›­å°åŒºå±‹é¡¶é˜²æ°´å·¥ç¨‹',
      description: 'è§£å†³å±‹é¡¶é•¿æœŸæ¸—æ°´é—®é¢˜ï¼Œé‡‡ç”¨æœ€æ–°é˜²æ°´ææ–™ï¼Œ5å¹´è´¨ä¿',
      content: 'åŸå¸‚èŠ±å›­å°åŒºå»ºäº2010å¹´ï¼Œå±‹é¡¶é•¿æœŸå­˜åœ¨æ¸—æ°´é—®é¢˜ï¼Œå½±å“å±…æ°‘æ­£å¸¸ç”Ÿæ´»ã€‚æˆ‘ä»¬ä½¿ç”¨é«˜åˆ†å­é˜²æ°´å·æå¯¹å±‹é¡¶è¿›è¡Œå…¨é¢é˜²æ°´å¤„ç†ï¼Œå¹¶å¢åŠ äº†æ’æ°´ç³»ç»Ÿæ”¹é€ ï¼Œå½»åº•è§£å†³äº†æ¼æ°´é—®é¢˜ã€‚è¯¥å·¥ç¨‹è¦†ç›–é¢ç§¯è¾¾2000å¹³æ–¹ç±³ï¼Œå·¥æœŸ15å¤©ï¼Œæä¾›5å¹´è´¨ä¿æœåŠ¡ã€‚'
    },
    {
      id: '2',
      imageUrl: 'https://storage.360buyimg.com/jdc-article/NutUItaro2.jpg',
      title: 'æ»¨æ±Ÿè±ªåº­åˆ«å¢…é˜²æ°´å·¥ç¨‹',
      description: 'åˆ«å¢…åœ°ä¸‹å®¤ã€æ¸¸æ³³æ± ã€å«ç”Ÿé—´æ•´ä½“é˜²æ°´ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±',
      content: 'æ»¨æ±Ÿè±ªåº­åˆ«å¢…æ˜¯é«˜ç«¯ä½å®…é¡¹ç›®ï¼Œä¸šä¸»è¦æ±‚å¯¹åœ°ä¸‹å®¤ã€æ¸¸æ³³æ± åŠå«ç”Ÿé—´è¿›è¡Œé«˜æ ‡å‡†é˜²æ°´å¤„ç†ã€‚æˆ‘ä»¬é‡‡ç”¨äº†åŒå±‚é˜²æ°´æŠ€æœ¯ï¼Œå†…å±‚ä½¿ç”¨æŸ”æ€§é˜²æ°´æ¶‚æ–™ï¼Œå¤–å±‚ä½¿ç”¨è‡ªç²˜é˜²æ°´å·æï¼Œå¹¶åœ¨å…³é”®éƒ¨ä½å¢åŠ äº†é˜²æ°´é™„åŠ å±‚ã€‚æ•´ä¸ªå·¥ç¨‹å†æ—¶25å¤©ï¼Œé˜²æ°´é¢ç§¯è¾¾800å¹³æ–¹ç±³ï¼Œé€šè¿‡äº†72å°æ—¶è“„æ°´æµ‹è¯•ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚'
    },
    {
      id: '3',
      imageUrl: 'https://storage.360buyimg.com/jdc-article/NutUItaro34.jpg',
      title: 'é˜³å…‰å•†åŸå¤–å¢™é˜²æ°´ç¿»æ–°',
      description: 'å¤§å‹å•†ä¸šç»¼åˆä½“å¤–å¢™é˜²æ°´ï¼Œç¾è§‚ä¸å®ç”¨å¹¶é‡',
      content: 'é˜³å…‰å•†åŸæ˜¯å¸‚ä¸­å¿ƒå¤§å‹å•†ä¸šç»¼åˆä½“ï¼Œå»ºæˆå·²æœ‰8å¹´ï¼Œå¤–å¢™å‡ºç°å¤šå¤„æ¸—æ°´å’Œå¢™é¢è„±è½ç°è±¡ã€‚æˆ‘ä»¬å¯¹æ•´ä¸ªå¤–å¢™è¿›è¡Œäº†æ¸…æ´ã€ä¿®å¤å’Œé˜²æ°´å¤„ç†ï¼Œé‡‡ç”¨äº†æ–°å‹çº³ç±³é˜²æ°´æ¶‚æ–™ï¼Œå…·æœ‰ä¼˜å¼‚çš„é˜²æ°´æ€§èƒ½å’Œè€å€™æ€§ã€‚å·¥ç¨‹é¢ç§¯è¾¾5000å¹³æ–¹ç±³ï¼Œä¸ä»…è§£å†³äº†æ¸—æ°´é—®é¢˜ï¼Œè¿˜æ¢å¤äº†å»ºç­‘å¤–è§‚ï¼Œä½¿å•†åŸç„•ç„¶ä¸€æ–°ã€‚'
    }
  ],
  
  // è”ç³»ä¿¡æ¯
  contactInfo: {
    phone: '400-123-4567',
    wechat: 'waterproof123'
  },
  
  // Banneræ•°æ® - ä¿®æ”¹æ ‡é¢˜
  banners: [
    {
      id: '1',
      imageUrl: 'https://img.picui.cn/free/2025/05/21/682d7803ab8ad.png',
      title: 'éƒ‘å¼ä¿®ç¼®',
      subtitle: 'ä¸“ä¸šä¿®ç¼® Â· å“è´¨ä¿éšœ'
    },
    {
      id: '2',
      imageUrl: 'https://img.picui.cn/free/2025/05/21/682d7803ab8ad.png',
      title: 'éƒ‘å¼ä¿®ç¼®',
      subtitle: 'ä¸“ä¸šä¿®ç¼® Â· å“è´¨ä¿éšœ'
    },
    {
      id: '3',
      imageUrl: 'https://img.picui.cn/free/2025/05/21/682d7803ab8ad.png',
      title: 'éƒ‘å¼ä¿®ç¼®',
      subtitle: 'ä¸“ä¸šä¿®ç¼® Â· å“è´¨ä¿éšœ'
    }
  ]
};
===== End of File: services\api\index\data.ts =====


===== File: services\api\index\indexApi.ts =====
// services/api/index/indexApi.ts
import http from '../../http';
import { IndexData, ApiResponse } from './types';
import { indexData } from './data';

// APIç«¯ç‚¹
const ENDPOINTS = {
  GET_INDEX_DATA: '/index',
};

/**
 * è·å–é¦–é¡µæ‰€æœ‰æ•°æ®
 */
export const getIndexData = async (): Promise<ApiResponse<IndexData>> => {
  try {
    // æ›¿æ¢ä¸ºå®é™…APIè°ƒç”¨å½“åç«¯å‡†å¤‡å¥½æ—¶
    // const data = await http.get<IndexData>(ENDPOINTS.GET_INDEX_DATA);
    
    // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
    await new Promise(resolve => setTimeout(resolve, 500));
    
    // è¿”å›æ¨¡æ‹Ÿæ•°æ®
    return {
      success: true,
      data: indexData
    };
  } catch (error: any) {
    return {
      success: false,
      error: error.message || 'è·å–é¦–é¡µæ•°æ®å¤±è´¥'
    };
  }
};

/**
 * é¦–é¡µæ¨¡å—é”™è¯¯å¤„ç†å·¥å…·
 */
export const handleIndexError = (err: any): string => {
  console.error('Index API Error:', err);
  return err instanceof Error ? err.message : 'è·å–é¦–é¡µæ•°æ®æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯';
};

// å¯¼å‡ºç±»å‹å’Œæ•°æ®
export * from './types';
export * from './data';
===== End of File: services\api\index\indexApi.ts =====


===== File: services\api\index\types.ts =====
// services/index/api/types.ts

// æœåŠ¡é¡¹æ¥å£ - åˆ é™¤featureså±æ€§
export interface Service {
    id: number | string;
    title: string;
    description: string;
}
  
// ç²¾é€‰æ¡ˆä¾‹æ¥å£
export interface Showcase {
    id: string;
    imageUrl: string;
    title: string;
    description: string;
    content: string;
}
  
// è”ç³»ä¿¡æ¯æ¥å£
export interface ContactInfo {
    phone: string;
    wechat: string;
}
  
// Banneræ¥å£
export interface Banner {
    id: string;
    imageUrl: string;
    title?: string;
    subtitle?: string;
}
  
// é¦–é¡µæ•°æ®æ¥å£
export interface IndexData {
    services: Service[];
    showcases: Showcase[];
    contactInfo: ContactInfo;
    banners: Banner[];
}
  
// APIå“åº”åŒ…è£…å™¨
export interface ApiResponse<T> {
    success: boolean;
    data?: T;
    error?: string;
}
===== End of File: services\api\index\types.ts =====


===== File: services\http\cache.ts =====
import Taro from '@tarojs/taro';
import type { CacheData } from './types';

// ç¼“å­˜é”®å‰ç¼€
const CACHE_PREFIX = 'http_cache_';

/**
 * ç”Ÿæˆç¼“å­˜é”®
 */
export function generateCacheKey(url: string, data?: any): string {
  return `${CACHE_PREFIX}${url}_${JSON.stringify(data || {})}`;
}

/**
 * è·å–ç¼“å­˜æ•°æ®
 */
export function getCacheData<T>(key: string): CacheData<T> | null {
  try {
    const cacheData = Taro.getStorageSync(key);
    return cacheData ? JSON.parse(cacheData) : null;
  } catch (error) {
    console.error('è·å–ç¼“å­˜æ•°æ®å¤±è´¥', error);
    return null;
  }
}

/**
 * è®¾ç½®ç¼“å­˜æ•°æ®
 */
export function setCacheData<T>(key: string, data: T): void {
    try {
      const cacheData: CacheData<T> = {
        data,
        timestamp: Date.now()
      };
      
      Taro.setStorageSync(key, JSON.stringify(cacheData));
    } catch (error) {
      console.error('è®¾ç½®ç¼“å­˜æ•°æ®å¤±è´¥', error);
    }
  }

/**
 * æ¸…é™¤ç¼“å­˜æ•°æ®
 */
export function clearCacheData(key: string): void {
  try {
    Taro.removeStorageSync(key);
  } catch (error) {
    console.error('æ¸…é™¤ç¼“å­˜æ•°æ®å¤±è´¥', error);
  }
}

/**
 * æ¸…é™¤æ‰€æœ‰HTTPç¼“å­˜
 */
export function clearAllCache(): void {
  try {
    const storageInfo = Taro.getStorageInfoSync();
    const keys = storageInfo.keys || [];
    
    keys.forEach(key => {
      if (key.startsWith(CACHE_PREFIX)) {
        Taro.removeStorageSync(key);
      }
    });
  } catch (error) {
    console.error('æ¸…é™¤æ‰€æœ‰ç¼“å­˜å¤±è´¥', error);
  }
}

/**
 * æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
 */
export function isCacheValid<T>(cache: CacheData<T>, cacheTime: number): boolean {
  if (!cache || !cache.timestamp) return false;
  
  return Date.now() - cache.timestamp < cacheTime;
}
===== End of File: services\http\cache.ts =====


===== File: services\http\config.ts =====
import type { RequestConfig } from './types';

// APIåŸºç¡€URL
export const API_BASE_URL = {
  // å¼€å‘ç¯å¢ƒ
  development: 'https://dev-api.example.com/v1',
  // ç”Ÿäº§ç¯å¢ƒ
  production: 'https://api.example.com/v1'
};

// ç¯å¢ƒåˆ¤æ–­
export const ENV = process.env.NODE_ENV || 'development';

// HTTPçŠ¶æ€ç 
export const HTTP_STATUS = {
  SUCCESS: 200,
  BAD_REQUEST: 400,
  UNAUTHORIZED: 401,
  FORBIDDEN: 403,
  NOT_FOUND: 404,
  SERVER_ERROR: 500
};

// ä¸šåŠ¡çŠ¶æ€ç 
export const BUSINESS_CODE = {
  SUCCESS: 0,           // æˆåŠŸ
  TOKEN_EXPIRED: 10001, // tokenè¿‡æœŸ
  PARAM_ERROR: 10002,   // å‚æ•°é”™è¯¯
  SERVER_ERROR: 50000   // æœåŠ¡å™¨é”™è¯¯
};

// é»˜è®¤è¯·æ±‚é…ç½®
export const DEFAULT_CONFIG: RequestConfig = {
  baseURL: API_BASE_URL[ENV],
  showLoading: true,
  loadingText: 'åŠ è½½ä¸­',
  showErrorToast: true,
  headers: {
    'Content-Type': 'application/json'
  },
  timeout: 10000,       // 10ç§’
  useCache: false,
  cacheTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿ
  retry: 0,
  retryDelay: 1000,
  withToken: true
};
===== End of File: services\http\config.ts =====


===== File: services\http\errorHandler.ts =====
import Taro from '@tarojs/taro';
import { HTTP_STATUS, BUSINESS_CODE } from './config';
import type { RequestError, RequestOptions } from './types';

/**
 * å¤„ç†HTTPçŠ¶æ€é”™è¯¯
 */
export function handleHttpError(statusCode: number): RequestError {
  let message = 'æœªçŸ¥é”™è¯¯';
  
  switch (statusCode) {
    case HTTP_STATUS.BAD_REQUEST:
      message = 'è¯·æ±‚å‚æ•°é”™è¯¯';
      break;
    case HTTP_STATUS.UNAUTHORIZED:
      message = 'æœªæˆæƒï¼Œè¯·ç™»å½•';
      break;
    case HTTP_STATUS.FORBIDDEN:
      message = 'æ²¡æœ‰æƒé™è®¿é—®';
      break;
    case HTTP_STATUS.NOT_FOUND:
      message = 'è¯·æ±‚èµ„æºä¸å­˜åœ¨';
      break;
    case HTTP_STATUS.SERVER_ERROR:
      message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯';
      break;
    default:
      message = `HTTPé”™è¯¯ (${statusCode})`;
  }
  
  return {
    code: statusCode,
    message
  };
}

/**
 * å¤„ç†ä¸šåŠ¡çŠ¶æ€é”™è¯¯
 */
export function handleBusinessError<T>(response: { code: number; message: string; data?: T }): RequestError {
  let message = response.message || 'æœªçŸ¥é”™è¯¯';
  
  switch (response.code) {
    case BUSINESS_CODE.TOKEN_EXPIRED:
      message = 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•';
      break;
    case BUSINESS_CODE.PARAM_ERROR:
      message = 'å‚æ•°é”™è¯¯';
      break;
    case BUSINESS_CODE.SERVER_ERROR:
      message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯';
      break;
  }
  
  return {
    code: response.code,
    message,
    data: response.data
  };
}

/**
 * å¤„ç†ç½‘ç»œé”™è¯¯
 */
export function handleNetworkError(error: any): RequestError {
  let message = 'ç½‘ç»œå¼‚å¸¸';
  
  if (error?.errMsg) {
    if (error.errMsg.includes('timeout')) {
      message = 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
    } else if (error.errMsg.includes('fail')) {
      message = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
    }
  }
  
  return {
    code: -1,
    message
  };
}

/**
 * ç»¼åˆé”™è¯¯å¤„ç†
 */
export function handleRequestError(error: any, options: RequestOptions): RequestError {
  // å·²æ ¼å¼åŒ–çš„é”™è¯¯
  if (error && typeof error === 'object' && 'code' in error && 'message' in error) {
    if (options.showErrorToast) {
      Taro.showToast({
        title: error.message,
        icon: 'none',
        duration: 2000
      });
    }
    
    return error as RequestError;
  }
  
  // HTTPé”™è¯¯
  if (error && typeof error === 'object' && 'statusCode' in error) {
    const httpError = handleHttpError(error.statusCode);
    
    if (options.showErrorToast) {
      Taro.showToast({
        title: httpError.message,
        icon: 'none',
        duration: 2000
      });
    }
    
    return httpError;
  }
  
  // ç½‘ç»œé”™è¯¯
  if (error && typeof error === 'object' && 'errMsg' in error) {
    const networkError = handleNetworkError(error);
    
    if (options.showErrorToast) {
      Taro.showToast({
        title: networkError.message,
        icon: 'none',
        duration: 2000
      });
    }
    
    return networkError;
  }
  
  // å…¶ä»–é”™è¯¯
  const unknownError: RequestError = {
    code: -1,
    message: typeof error === 'string' ? error : 'æœªçŸ¥é”™è¯¯'
  };
  
  if (options.showErrorToast) {
    Taro.showToast({
      title: unknownError.message,
      icon: 'none',
      duration: 2000
    });
  }
  
  return unknownError;
}
===== End of File: services\http\errorHandler.ts =====


===== File: services\http\index.ts =====
import { request } from './request';
import type { RequestOptions} from './types';
import { addRequestInterceptor, addResponseInterceptor, addErrorInterceptor } from './interceptor';
import { clearAllCache, clearCacheData } from './cache';

/**
 * HTTPå®¢æˆ·ç«¯
 */
const http = {
  /**
   * å‘é€GETè¯·æ±‚
   */
  get: <T = any>(url: string, data?: any, options?: Partial<RequestOptions>) => 
    request<T>({ url, method: 'GET', data, ...options }),
  
  /**
   * å‘é€POSTè¯·æ±‚
   */  
  post: <T = any>(url: string, data?: any, options?: Partial<RequestOptions>) => 
    request<T>({ url, method: 'POST', data, ...options }),
  
  /**
   * å‘é€PUTè¯·æ±‚
   */
  put: <T = any>(url: string, data?: any, options?: Partial<RequestOptions>) => 
    request<T>({ url, method: 'PUT', data, ...options }),
  
  /**
   * å‘é€DELETEè¯·æ±‚
   */
  delete: <T = any>(url: string, data?: any, options?: Partial<RequestOptions>) => 
    request<T>({ url, method: 'DELETE', data, ...options }),
  
  /**
   * åŸå§‹è¯·æ±‚æ–¹æ³•
   */
  request,
  
  /**
   * æ¸…é™¤æŒ‡å®šç¼“å­˜
   */
  clearCache: clearCacheData,
  
  /**
   * æ¸…é™¤æ‰€æœ‰ç¼“å­˜
   */
  clearAllCache,
  
  /**
   * æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
   */
  addRequestInterceptor,
  
  /**
   * æ·»åŠ å“åº”æ‹¦æˆªå™¨
   */
  addResponseInterceptor,
  
  /**
   * æ·»åŠ é”™è¯¯æ‹¦æˆªå™¨
   */
  addErrorInterceptor
};

export default http;

// å¯¼å‡ºç±»å‹
export * from './types';
export { DEFAULT_CONFIG } from './config';
===== End of File: services\http\index.ts =====


===== File: services\http\interceptor.ts =====
import Taro from '@tarojs/taro';
import type { RequestInterceptor, ResponseInterceptor, ErrorInterceptor, RequestOptions, ResponseData } from './types';
import { BUSINESS_CODE } from './config';

// è¯·æ±‚æ‹¦æˆªå™¨æ•°ç»„
const requestInterceptors: RequestInterceptor[] = [];

// å“åº”æ‹¦æˆªå™¨æ•°ç»„
const responseInterceptors: ResponseInterceptor[] = [];

// é”™è¯¯æ‹¦æˆªå™¨æ•°ç»„
const errorInterceptors: ErrorInterceptor[] = [];

/**
 * æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
 */
export function addRequestInterceptor(interceptor: RequestInterceptor): void {
  requestInterceptors.push(interceptor);
}

/**
 * æ·»åŠ å“åº”æ‹¦æˆªå™¨
 */
export function addResponseInterceptor(interceptor: ResponseInterceptor): void {
  responseInterceptors.push(interceptor);
}

/**
 * æ·»åŠ é”™è¯¯æ‹¦æˆªå™¨
 */
export function addErrorInterceptor(interceptor: ErrorInterceptor): void {
  errorInterceptors.push(interceptor);
}

/**
 * åº”ç”¨è¯·æ±‚æ‹¦æˆªå™¨
 */
export async function applyRequestInterceptors(options: RequestOptions): Promise<RequestOptions> {
  let config = { ...options };
  
  for (const interceptor of requestInterceptors) {
    config = await interceptor(config);
  }
  
  return config;
}

/**
 * åº”ç”¨å“åº”æ‹¦æˆªå™¨
 */
export async function applyResponseInterceptors<T>(response: ResponseData<T>, options: RequestOptions): Promise<ResponseData<T>> {
  let result = { ...response };
  
  for (const interceptor of responseInterceptors) {
    result = await interceptor(result, options);
  }
  
  return result;
}

/**
 * åº”ç”¨é”™è¯¯æ‹¦æˆªå™¨
 */
export async function applyErrorInterceptors(error: any, options: RequestOptions): Promise<any> {
  let result = error;
  
  for (const interceptor of errorInterceptors) {
    result = await interceptor(result, options);
  }
  
  return result;
}

// æ·»åŠ é»˜è®¤Tokenæ‹¦æˆªå™¨
addRequestInterceptor(async (options) => {
  if (options.withToken) {
    try {
      const token = Taro.getStorageSync('token');
      if (token) {
        options.headers = {
          ...options.headers,
          'Authorization': `Bearer ${token}`
        };
      }
    } catch (error) {
      console.error('è·å–Tokenå¤±è´¥', error);
    }
  }
  
  return options;
});

// æ·»åŠ é»˜è®¤æ—¥å¿—æ‹¦æˆªå™¨
if (process.env.NODE_ENV === 'development') {
  // è¯·æ±‚æ—¥å¿—
  addRequestInterceptor((options) => {
    console.log(`[Request] ${options.method} ${options.url}`, options.data);
    return options;
  });
  
  // å“åº”æ—¥å¿—
  addResponseInterceptor((response, options) => {
    console.log(`[Response] ${options.method} ${options.url}`, response);
    return response;
  });
  
  // é”™è¯¯æ—¥å¿—
  addErrorInterceptor((error, options) => {
    console.error(`[Error] ${options.method} ${options.url}`, error);
    return error;
  });
}

// æ·»åŠ é»˜è®¤Tokenè¿‡æœŸå¤„ç†
addErrorInterceptor((error) => {
  if (error && error.code === BUSINESS_CODE.TOKEN_EXPIRED) {
    // æ¸…é™¤æœ¬åœ°Token
    Taro.removeStorageSync('token');
    
    // è·³è½¬åˆ°ç™»å½•é¡µ
    Taro.navigateTo({
      url: '/pages/login/index'
    });
  }
  
  return error;
});
===== End of File: services\http\interceptor.ts =====


===== File: services\http\request.ts =====
import Taro from '@tarojs/taro';
import type { RequestOptions, ResponseData } from './types';
import { DEFAULT_CONFIG, BUSINESS_CODE } from './config';
import { applyRequestInterceptors, applyResponseInterceptors, applyErrorInterceptors } from './interceptor';
import { handleRequestError, handleBusinessError } from './errorHandler';
import { generateCacheKey, getCacheData, setCacheData, isCacheValid } from './cache';

// è¯·æ±‚è®¡æ•°å™¨
let loadingCount = 0;

/**
 * æ˜¾ç¤ºåŠ è½½æç¤º
 */
function showLoading(text: string): void {
  loadingCount++;
  
  if (loadingCount === 1) {
    Taro.showLoading({ title: text });
  }
}

/**
 * éšè—åŠ è½½æç¤º
 */
function hideLoading(): void {
  loadingCount--;
  
  if (loadingCount === 0) {
    Taro.hideLoading();
  }
}

/**
 * å»¶è¿Ÿå‡½æ•°
 */
function delay(ms: number): Promise<void> {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * ç»Ÿä¸€è¯·æ±‚å‡½æ•°
 */
export async function request<T = any>(options: RequestOptions): Promise<T> {
  // åˆå¹¶é…ç½®
  const config = { ...DEFAULT_CONFIG, ...options };
  const { url, method = 'GET', data, baseURL, showLoading: shouldShowLoading, loadingText, useCache, cacheTime, retry, retryDelay } = config;
  
  // å®Œæ•´URL
  const fullUrl = url.startsWith('http') ? url : `${baseURL}${url.startsWith('/') ? url : `/${url}`}`;
  
  // æ£€æŸ¥ç¼“å­˜
  if (useCache && method === 'GET') {
    const cacheKey = generateCacheKey(fullUrl, data);
    const cached = getCacheData<T>(cacheKey);
    
    if (cached && isCacheValid(cached, cacheTime || DEFAULT_CONFIG.cacheTime || 0)) {
      return cached.data;
    }
  }
  
  // è¯·æ±‚å‰å¤„ç†
  let requestConfig = await applyRequestInterceptors({ ...config, url: fullUrl });
  
  // é‡è¯•è®¡æ•°
  let retryCount = retry || 0;
  
  // æ˜¾ç¤ºåŠ è½½æç¤º
  if (shouldShowLoading) {
    showLoading(loadingText || 'åŠ è½½ä¸­');
  }
  
  try {
    // å‘é€è¯·æ±‚
    const executeRequest = async (): Promise<T> => {
      try {
        const response = await Taro.request({
          url: fullUrl,
          data: requestConfig.data,
          method: requestConfig.method as any,
          header: requestConfig.headers,
          timeout: requestConfig.timeout
        });
        
        // HTTPçŠ¶æ€æ£€æŸ¥
        if (response.statusCode !== 200) {
          throw { statusCode: response.statusCode };
        }
        
        // ä¸šåŠ¡çŠ¶æ€æ£€æŸ¥
        const responseData = response.data as ResponseData<T>;
        
        if (responseData.code !== BUSINESS_CODE.SUCCESS) {
          throw handleBusinessError(responseData);
        }
        
        // å“åº”æ‹¦æˆªå¤„ç†
        const processedResponse = await applyResponseInterceptors(responseData, requestConfig);
        
        // è®¾ç½®ç¼“å­˜
        if (useCache && method === 'GET') {
          const cacheKey = generateCacheKey(fullUrl, data);
          setCacheData(cacheKey, processedResponse.data);
        }
        
        return processedResponse.data;
      } catch (error) {
        // è¯·æ±‚å¤±è´¥ä½†è¿˜æœ‰é‡è¯•æ¬¡æ•°
        if (retryCount > 0) {
          retryCount--;
          // å»¶è¿Ÿåé‡è¯•
          await delay(retryDelay || DEFAULT_CONFIG.retryDelay || 1000);
          return executeRequest();
        }
        
        // é‡è¯•æ¬¡æ•°ç”¨å®Œï¼Œå‘ä¸ŠæŠ›å‡ºé”™è¯¯
        throw error;
      }
    };
    
    return await executeRequest();
  } catch (error) {
    // é”™è¯¯å¤„ç†
    const processedError = await applyErrorInterceptors(error, requestConfig);
    throw handleRequestError(processedError, requestConfig);
  } finally {
    // éšè—åŠ è½½æç¤º
    if (shouldShowLoading) {
      hideLoading();
    }
  }
}
===== End of File: services\http\request.ts =====


===== File: services\http\types.ts =====
// è¯·æ±‚æ–¹æ³•ç±»å‹
export type RequestMethod = 'GET' | 'POST' | 'PUT' | 'DELETE';

// è¯·æ±‚é…ç½®
export interface RequestConfig {
  // åŸºç¡€URL
  baseURL?: string;
  // æ˜¯å¦æ˜¾ç¤ºåŠ è½½æç¤º
  showLoading?: boolean;
  // åŠ è½½æç¤ºæ–‡å­—
  loadingText?: string;
  // æ˜¯å¦æ˜¾ç¤ºé”™è¯¯æç¤º
  showErrorToast?: boolean;
  // è¯·æ±‚å¤´
  headers?: Record<string, string>;
  // è¶…æ—¶æ—¶é—´(ms)
  timeout?: number;
  // æ˜¯å¦ä½¿ç”¨ç¼“å­˜(ä»…GETè¯·æ±‚)
  useCache?: boolean;
  // ç¼“å­˜æ—¶é—´(ms)
  cacheTime?: number;
  // é‡è¯•æ¬¡æ•°
  retry?: number;
  // é‡è¯•å»¶è¿Ÿ(ms)
  retryDelay?: number;
  // æ˜¯å¦è‡ªåŠ¨æºå¸¦token
  withToken?: boolean;
}

// è¯·æ±‚å‚æ•°
export interface RequestOptions extends RequestConfig {
  // è¯·æ±‚åœ°å€
  url: string;
  // è¯·æ±‚æ–¹æ³•
  method?: RequestMethod;
  // è¯·æ±‚æ•°æ®
  data?: any;
}

// å“åº”æ•°æ®ç»“æ„
export interface ResponseData<T = any> {
  code: number;
  message: string;
  data: T;
}

// ç¼“å­˜æ•°æ®ç»“æ„
export interface CacheData<T = any> {
  data: T;
  timestamp: number;
}

// é”™è¯¯ä¿¡æ¯ç»“æ„
export interface RequestError {
  code: number;
  message: string;
  data?: any;
}

// è¯·æ±‚æ‹¦æˆªå™¨
export type RequestInterceptor = (options: RequestOptions) => RequestOptions | Promise<RequestOptions>;

// å“åº”æ‹¦æˆªå™¨
export type ResponseInterceptor = <T>(response: ResponseData<T>, options: RequestOptions) => ResponseData<T> | Promise<ResponseData<T>>;

// é”™è¯¯æ‹¦æˆªå™¨
export type ErrorInterceptor = (error: any, options: RequestOptions) => any;
===== End of File: services\http\types.ts =====


===== File: styles\theme.css =====
:root,
page{
  /* ä¸»å“ç‰Œè‰²ç³» - è“è‰²ç³»åˆ—ï¼Œä»æµ…åˆ°æ·± */
  --nutui-brand-1: #EFF6FF; /* æœ€æµ…è“è‰² - é€‚åˆèƒŒæ™¯ã€é«˜äº®åŒºåŸŸ */
  --nutui-brand-2: #DBEAFE; /* æµ…è“è‰² - ç”¨äºè½»é‡å¼ºè°ƒå’ŒèƒŒæ™¯ */
  --nutui-brand-3: #BFDBFE; /* ä¸­æµ…è“è‰² - ç¦ç”¨çŠ¶æ€ */
  --nutui-brand-4: #93C5FD; /* æ¸å˜èµ·å§‹è‰² */
  --nutui-brand-5: #60A5FA; /* ä¸­é—´è¿‡æ¸¡è‰² */
  --nutui-brand-6: #3B82F6; /* ä¸»è‰²è°ƒ - äº®è“è‰² */
  --nutui-brand-7: #2563EB; /* æŒ‰å‹çŠ¶æ€è‰² - ä¸TabBaré€‰ä¸­è‰²ç›¸åŒ */
  --nutui-brand-8: #1D4ED8; /* æ·±è“è‰² - æ¸å˜ç»“æŸè‰² */
  --nutui-brand-9: #1E40AF; /* å¾ˆæ·±è“è‰² */
  --nutui-brand-10: #1E3A8A; /* æœ€æ·±è“è‰² */
  
  /* æ¸å˜è‰²è®¾ç½® */
  --nutui-brand-stop-1: #60A5FA; /* æ¸å˜èµ·å§‹è‰² - å¯¹åº”brand-5 */
  --nutui-brand-stop-2: #2563EB; /* æ¸å˜ç»“æŸè‰² - å¯¹åº”brand-7ï¼Œä¸TabBarä¸€è‡´ */
  
  /* å¼ºè°ƒè‰² - ç”¨äºç‰¹æ®Šå…ƒç´ ï¼Œé˜²æ°´ä¸»é¢˜å¯ä»¥ç”¨è“ç»¿è‰² */
  --nutui-secondary-1: #0EA5E9; /* è“ç»¿è‰²å¼ºè°ƒè‰² - ä¸æ°´ç›¸å…³ */
  
  /* ä¸»è‰²è°ƒæ˜ å°„ */
  --nutui-color-primary: #2563EB; /* ä¸TabBaré€‰ä¸­è‰²ä¿æŒä¸€è‡´ */
  --nutui-color-primary-stop-1: var(--nutui-brand-stop-1);
  --nutui-color-primary-stop-2: var(--nutui-brand-stop-2);
  --nutui-color-primary-pressed: var(--nutui-brand-8);
  --nutui-color-primary-disabled: var(--nutui-brand-3);
  --nutui-color-primary-text: #FFFFFF;
  --nutui-color-primary-light: var(--nutui-brand-2);
  
  /* æ–‡æœ¬ç³»ç»Ÿ */
  --nutui-gray-7: #1F2937; /* ä¸»è¦æ–‡æœ¬ */
  --nutui-gray-6: #4B5563; /* é‡è¦æ¬¡è¦æ–‡æœ¬ */
  --nutui-gray-5: #6B7280; /* æ¬¡è¦æ–‡æœ¬ */
  --nutui-gray-4: #9CA3AF; /* åˆ†å‰²çº¿/ç¦ç”¨æ–‡æœ¬ */
  
  /* èƒŒæ™¯ç³»ç»Ÿ */
  --nutui-gray-1: #FFFFFF; /* ç™½è‰²èƒŒæ™¯ - ä¸navigationBarèƒŒæ™¯ä¸€è‡´ */
  --nutui-gray-2: #F9FAFB; /* æµ…ç°èƒŒæ™¯ - å¡ç‰‡å†…åµŒèƒŒæ™¯ */
  --nutui-gray-3: #F3F4F6; /* ç°è‰²èƒŒæ™¯ - é¡µé¢åŸºåº•è‰² */
  
  /* åŠŸèƒ½è‰²è®¾ç½® - ä¸é˜²æ°´æœåŠ¡ä¸»é¢˜ç›¸åè°ƒ */
  --nutui-color-success: #10B981; /* æˆåŠŸè‰² - ç»¿è‰²ï¼Œä»£è¡¨å®‰å…¨å¯é  */
  --nutui-color-success-disabled: #D1FAE5;
  --nutui-color-danger: #EF4444; /* å±é™©è‰² - çº¢è‰²ï¼Œä»£è¡¨è­¦ç¤º */
  --nutui-color-danger-disabled: #FEE2E2;
  --nutui-color-warning: #F59E0B; /* è­¦å‘Šè‰² - æ©™è‰² */
  --nutui-color-warning-disabled: #FEF3C7;
  --nutui-color-info: #3B82F6; /* ä¿¡æ¯è‰² - è“è‰²ï¼Œä¸æ°´ç›¸å…³ */
  --nutui-color-info-disabled: #BFDBFE;
  --nutui-color-info-background: linear-gradient(315deg, #60A5FA 0%, #2563EB 100%);
  
  /* TabBaré¢œè‰²è®¾ç½® - ä¿æŒä¸€è‡´æ€§ */
  --nutui-tabbar-active-color: #2563EB; /* ä¸TabBaré€‰ä¸­è‰²ä¿æŒä¸€è‡´ */
  --nutui-tabbar-inactive-color: #999999; /* ä¸TabBaræœªé€‰ä¸­è‰²ä¿æŒä¸€è‡´ */

  --nutui-picker-title-ok-font-size: 16px;/*pickeré¢æ¿ç¡®è®¤å­—å·*/
  --nutui-picker-item-height: 40px; /*pickeré¢æ¿æ¯ä¸€æ¡æ•°æ®é«˜åº¦*/
  --nutui-picker-list-height: 180px;
  --nutui-picker-title-cancel-font-size: 16px;
}
===== End of File: styles\theme.css =====

